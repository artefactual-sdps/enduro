-- Create "batch" table
CREATE TABLE `batch` (`id` bigint NOT NULL AUTO_INCREMENT, `uuid` char(36) NOT NULL, `identifier` varchar(2048) NOT NULL, `status` enum('queued','processing','pending','ingested','canceled') NOT NULL, `sips_count` bigint NOT NULL, `created_at` timestamp NOT NULL, `started_at` timestamp NULL, `completed_at` timestamp NULL, `uploader_id` bigint NULL, PRIMARY KEY (`id`), INDEX `batch_created_at_idx` (`created_at`), INDEX `batch_identifier_idx` (`identifier` (50)), INDEX `batch_started_at_idx` (`started_at`), INDEX `batch_status_idx` (`status`), INDEX `batch_uploader_id_idx` (`uploader_id`), UNIQUE INDEX `uuid` (`uuid`), CONSTRAINT `batch_user_uploaded_batches` FOREIGN KEY (`uploader_id`) REFERENCES `user` (`id`) ON UPDATE NO ACTION ON DELETE SET NULL) CHARSET utf8mb4 COLLATE utf8mb4_bin;
-- Modify "sip" table
ALTER TABLE `sip` ADD COLUMN `batch_id` bigint NULL, ADD INDEX `sip_batch_id_idx` (`batch_id`), ADD CONSTRAINT `sip_batch_sips` FOREIGN KEY (`batch_id`) REFERENCES `batch` (`id`) ON UPDATE NO ACTION ON DELETE SET NULL;
